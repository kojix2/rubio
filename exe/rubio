#!/usr/bin/env ruby
# frozen_string_literal: true

require 'rubio'

require 'optparse'
backend = 'vlc -I dummy'
options = {}
opt = OptionParser.new
opt.on('--vlc') { backend = 'vlc -I rc' }
opt.on('--mpg123') { backend = 'mpg123' }
opt.on('--backend CMD') { |b| backend = b }
opt.on('--count RADIO_STATION_COUNT') { |c| options[:radio_station_count] = c }
opt.on('--width WINDOW_WIDTH') { |w| options[:initial_width] = w }
opt.on('--height WINDOW_HEIGHT') { |h| options[:initial_height] = h }
opt.on('--debug') { options[:debug] = true }
opt.on('--help') do
  puts opt
  exit
end
opt.on('--version') do
  puts Rubio::VERSION
  exit
end
opt.parse!(ARGV)

radio = Rubio::Radio.new(backend, **options)
begin
  radio.launch
rescue StandardError => e
  radio&.player&.stop_all
  raise e
end
